// Generated by CoffeeScript 1.6.1
(function() {
  var Fs, Logger, Path, Program, Runner, log, pkg, version;

  Fs = require("fs");

  Logger = require("../lib/common/logger");

  Path = require("path");

  Program = require("commander");

  Runner = require("../lib/pm-build/runner");

  log = Logger.getLogger("pm-create");

  pkg = require("../../package.json");

  version = pkg.version;

  Program.version(version).parse(process.argv);

  exports.run = function() {
    var cwd, executeTasks, proj, projfile, runner, tasks;
    try {
      tasks = Program.args.slice(1);
      projfile = findProjfile();
      log.debug("environment=" + Program.environment + "\nprojfile=" + projfile);
      runner = new Runner();
      runner.program = Program;
      cwd = process.cwd();
      process.chdir(Path.dirname(projfile));
      proj = loadProjfile();
      if (!proj.project) {
        throw new Error("" + projfile + " does not export `project` function");
      }
      executeTasks = function(err) {
        if (err) {
          return log.error(err);
        }
        return runner.executeTasks(tasks, function(err) {
          if (err) {
            return log.error(err);
          }
        });
      };
      if (proj.project.length === 1) {
        proj.project(runner);
        return executeTasks();
      } else {
        return proj.project(runner, executeTasks);
      }
    } catch (e) {
      return log.error(e);
    }
  };

  exports.meta = {
    name: "gen",
    description: "Generates a project from git repository.",
    quickUsage: function() {
      return "" + (taskDescriptions());
    },
    usage: function() {
      return "gen - Generates a project from a git repository.\n\nUsage: pm gen OPTIONS GITURL";
    }
  };

}).call(this);
