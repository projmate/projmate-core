// Generated by CoffeeScript 1.6.1
(function() {
  var Fs, Path, glob, main, requireScript, usage;

  Fs = require("fs");

  Path = require("path");

  glob = require("multi-glob").glob;

  usage = function() {
    return glob("" + __dirname + "/pm-*.js", function(err, files) {
      var commandHelp, file, moduleFile, script, _i, _len;
      if (err) {
        return console.error(err);
      }
      commandHelp = "";
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        moduleFile = file.slice(("" + __dirname + "/").length);
        script = requireScript(moduleFile);
        if (script) {
          commandHelp += "  " + script.meta.name + "\t\t" + script.meta.description;
        }
      }
      return console.log("pm COMMAND [OPTIONS]\n\nCOMMANDS\n  help COMMAND  Displays help about specific command\n" + commandHelp);
    });
  };

  requireScript = function(name) {
    var moduleName;
    if (Fs.existsSync(Path.join(__dirname, name))) {
      moduleName = Path.basename(name, Path.extname(name));
      return require("./" + moduleName);
    }
    return null;
  };

  main = function() {
    var command, file, nextCommand, printScriptUsage, script;
    command = process.argv[2];
    printScriptUsage = function(script) {
      return script.meta.usage(function(err, message) {
        if (err) {
          return console.error(err);
        } else {
          return console.log(message);
        }
      });
    };
    if (command === "help") {
      command = process.argv[3];
      file = "pm-" + command + ".js";
      script = requireScript(file);
      if (script) {
        return printScriptUsage(script);
      } else {
        return console.error("Command not found: " + command);
      }
    } else if (command === "--help" || command === "-?") {
      return usage();
    } else if (command) {
      file = "pm-" + command + ".js";
      script = requireScript(file);
      if (!script) {
        console.error("Command not found: " + command);
        process.exit(1);
      }
      nextCommand = process.argv[3];
      if (nextCommand === "-?" || nextCommand === "--help") {
        return printScriptUsage(script);
      } else {
        return script.run();
      }
    } else {
      return usage();
    }
  };

  main();

}).call(this);
